import{c as R,r as l,u as I,j as e,S as f,m as L,k as F,U as $}from"./index-B0U1T1C1.js";import{U as i}from"./user.service-eXvVqay8.js";import{S as q}from"./search-DnLxAvwA.js";import{C as z}from"./check-circle-BtgdL02B.js";import{X as K}from"./x-circle-DBcbp7z3.js";import{K as O}from"./key-smfloJ8n.js";import{T}from"./trash-2-CKwnef7w.js";const W=R("Power",[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]]),Y=()=>{var y;const[c,o]=l.useState([]),[j,w]=l.useState(!0),[x,A]=l.useState(""),{user:m}=I(),[k,p]=l.useState(!1),[E,h]=l.useState(!1),[d,b]=l.useState(null),[g,N]=l.useState(""),[n,u]=l.useState({username:"",password:""});l.useEffect(()=>{v()},[x]);const v=async()=>{w(!0);try{const s=await i.getAll({search:x}),r=(s.results||s).map(a=>a.user?{...a.user,profile_id:a.id,date_joined:a.created_at,profile:{...a.user.profile,role:a.role}}:a);o(r)}catch(s){console.error("Error fetching users",s)}finally{w(!1)}},U=s=>{A(s.target.value)},_=async s=>{if(window.confirm(`Are you sure you want to ${s.is_active?"deactivate":"activate"} this user?`))try{await i.toggleActivation(s.profile_id),o(c.map(t=>t.id===s.id?{...t,is_active:!t.is_active}:t))}catch(t){console.error("Error toggling activation",t),alert("Failed to update user status.")}},P=async s=>{if(window.confirm(`Are you sure you want to delete user ${s.username}? This cannot be undone.`))try{await i.delete(s.profile_id),o(c.filter(t=>t.id!==s.id))}catch(t){console.error("Error deleting user",t),alert("Failed to delete user.")}},D=async s=>{s.preventDefault();try{await i.changePassword({user_id:d.id,new_password:g}),alert("Password changed successfully."),p(!1),N(""),b(null)}catch(t){console.error("Error changing password",t),alert("Failed to change password.")}},M=async s=>{var t,r;s.preventDefault();try{await i.registerAdmin(n),alert("Admin created successfully."),h(!1),u({username:"",password:""}),v()}catch(a){console.error("Error creating admin",a),alert(((r=(t=a.response)==null?void 0:t.data)==null?void 0:r.detail)||"Failed to create admin.")}};return j?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-6 animate-fade-in pb-10",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-slate-900 tracking-tight",children:"Manage Users"}),e.jsx("p",{className:"text-slate-500 mt-1",children:"View and manage system users and their roles."})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative w-full md:w-80",children:[e.jsx(q,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"Search users...",value:x,onChange:U,className:"input-field !pl-10"})]}),((y=m==null?void 0:m.profile)==null?void 0:y.is_owner)&&e.jsxs("button",{onClick:()=>h(!0),className:"bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 font-bold shadow-md shadow-purple-200 transition-all active:scale-95 whitespace-nowrap",children:[e.jsx(f,{className:"w-4 h-4"})," Register Admin"]})]})]}),e.jsx("div",{className:"card overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-slate-50 border-b border-slate-200",children:[e.jsx("th",{className:"px-6 py-4 text-xs font-bold text-slate-500 uppercase tracking-wider",children:"User"}),e.jsx("th",{className:"px-6 py-4 text-xs font-bold text-slate-500 uppercase tracking-wider",children:"Role"}),e.jsx("th",{className:"px-6 py-4 text-xs font-bold text-slate-500 uppercase tracking-wider",children:"Email"}),e.jsx("th",{className:"px-6 py-4 text-xs font-bold text-slate-500 uppercase tracking-wider",children:"Joined Date"}),e.jsx("th",{className:"px-6 py-4 text-xs font-bold text-slate-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-4 text-xs font-bold text-slate-500 uppercase tracking-wider text-right",children:"Actions"})]})}),e.jsxs("tbody",{className:"divide-y divide-slate-100 bg-white",children:[c.map(s=>{var t,r,a,S,C;return e.jsxs("tr",{className:"hover:bg-slate-50 transition-colors group",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center text-slate-600 font-bold text-sm border border-slate-200",children:s.username.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-slate-900",children:s.username}),e.jsxs("div",{className:"text-xs text-slate-500",children:["ID: #",s.id]})]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-bold border ${((t=s.profile)==null?void 0:t.role)==="OWNER"?"bg-yellow-50 text-yellow-700 border-yellow-100":((r=s.profile)==null?void 0:r.role)==="ADMIN"?"bg-purple-50 text-purple-700 border-purple-100":"bg-blue-50 text-blue-700 border-blue-100"}`,children:[((a=s.profile)==null?void 0:a.role)==="OWNER"&&e.jsx(L,{className:"w-3 h-3 mr-1"}),((S=s.profile)==null?void 0:S.role)==="ADMIN"&&e.jsx(f,{className:"w-3 h-3 mr-1"}),((C=s.profile)==null?void 0:C.role)||"STUDENT"]})}),e.jsx("td",{className:"px-6 py-4 text-sm text-slate-600",children:s.email||e.jsx("span",{className:"text-slate-400 italic",children:"No email"})}),e.jsx("td",{className:"px-6 py-4 text-sm text-slate-600",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{className:"w-4 h-4 text-slate-400"}),new Date(s.date_joined).toLocaleDateString()]})}),e.jsx("td",{className:"px-6 py-4",children:s.is_active?e.jsxs("div",{className:"flex items-center gap-1.5 text-emerald-700 text-sm font-medium",children:[e.jsx(z,{className:"w-4 h-4"})," Active"]}):e.jsxs("div",{className:"flex items-center gap-1.5 text-red-700 text-sm font-medium",children:[e.jsx(K,{className:"w-4 h-4"})," Inactive"]})}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{onClick:()=>_(s),className:`p-1.5 rounded-lg transition-colors ${s.is_active?"text-orange-500 hover:bg-orange-50":"text-emerald-500 hover:bg-emerald-50"}`,title:s.is_active?"Deactivate User":"Activate User",children:e.jsx(W,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>{b(s),p(!0)},className:"p-1.5 text-blue-500 hover:bg-blue-50 rounded-lg transition-colors",title:"Change Password",children:e.jsx(O,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>P(s),className:"p-1.5 text-red-500 hover:bg-red-50 rounded-lg transition-colors",title:"Delete User",children:e.jsx(T,{className:"w-4 h-4"})})]})})]},s.id)}),c.length===0&&!j&&e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"px-6 py-16 text-center text-slate-500",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-16 h-16 bg-slate-50 rounded-full flex items-center justify-center mb-4",children:e.jsx($,{className:"w-8 h-8 text-slate-300"})}),e.jsx("p",{className:"font-medium",children:"No users found."})]})})})]})]})})}),k&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/50 backdrop-blur-sm animate-fade-in",children:e.jsxs("div",{className:"bg-white w-full max-w-md rounded-xl shadow-2xl p-6 animate-slide-up",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900 mb-4",children:"Change Password"}),e.jsxs("p",{className:"text-slate-500 mb-6 text-sm",children:["Enter a new password for ",e.jsx("span",{className:"font-bold text-slate-700",children:d==null?void 0:d.username}),"."]}),e.jsxs("form",{onSubmit:D,className:"space-y-4",children:[e.jsx("input",{type:"password",placeholder:"New Password",value:g,onChange:s=>N(s.target.value),className:"input-field",required:!0,minLength:6}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx("button",{type:"button",onClick:()=>p(!1),className:"px-4 py-2 text-slate-600 hover:bg-slate-100 rounded-lg transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition-colors",children:"Save Password"})]})]})]})}),E&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/50 backdrop-blur-sm animate-fade-in",children:e.jsxs("div",{className:"bg-white w-full max-w-md rounded-xl shadow-2xl p-8 animate-slide-up",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(f,{className:"w-6 h-6 text-purple-600"})}),e.jsx("h2",{className:"text-xl font-bold text-slate-900",children:"Register New Admin"})]}),e.jsx("p",{className:"text-slate-500 mb-6 text-sm",children:"Create a new administrator account. They can login and change their details later."}),e.jsxs("form",{onSubmit:M,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-xs font-bold text-slate-700 uppercase",children:"Username"}),e.jsx("input",{type:"text",placeholder:"Enter username",value:n.username,onChange:s=>u({...n,username:s.target.value}),className:"input-field",required:!0})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-xs font-bold text-slate-700 uppercase",children:"Temp Password"}),e.jsx("input",{type:"password",placeholder:"Enter password",value:n.password,onChange:s=>u({...n,password:s.target.value}),className:"input-field",required:!0,minLength:6})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-8",children:[e.jsx("button",{type:"button",onClick:()=>h(!1),className:"px-4 py-2 text-slate-600 hover:bg-slate-100 rounded-lg transition-colors font-medium",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-6 py-2 bg-purple-600 text-white font-bold rounded-lg hover:bg-purple-700 transition-colors shadow-lg shadow-purple-200",children:"Create Admin"})]})]})]})})]})};export{Y as default};
