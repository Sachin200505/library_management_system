import{r as l,u as K,j as e,B as V,h as $,C as Z,X as ee}from"./index-B0U1T1C1.js";import{B as d}from"./book.service-CAcsJwBd.js";import{I as te}from"./issue.service-CORyrTen.js";import{R as se}from"./reservation.service-BfQRBp_R.js";import{l as ae,C as re,a as le}from"./lodash-BI20lBqQ.js";import{B as oe}from"./book-open-CIpCioG8.js";import{S as P}from"./search-DnLxAvwA.js";import{P as I}from"./plus-l3sj6by8.js";import{C as ie}from"./check-Ce-VbAi1.js";import{T as ne}from"./trash-2-CKwnef7w.js";const ve=()=>{var F;const[v,A]=l.useState([]),[q,_]=l.useState(!0),[u,B]=l.useState(""),{user:o}=K(),[i,N]=l.useState({}),[x,h]=l.useState(1),[c,E]=l.useState({next:null,previous:null,count:0}),[z,m]=l.useState(!1),[L,M]=l.useState([]),[T,Y]=l.useState([]),[a,n]=l.useState({title:"",author_id:"",category_id:"",isbn:"",quantity:1,description:"",published_year:new Date().getFullYear()}),[p,j]=l.useState(!1),[w,D]=l.useState(""),[b,y]=l.useState(!1),[C,R]=l.useState(""),k=async(t,s)=>{_(!0);try{const r=await d.getAll({search:t,page:s});r.results?(A(r.results),E({next:r.next,previous:r.previous,count:r.count})):(A(r),E({next:null,previous:null,count:r.length}))}catch(r){console.error("Error fetching books",r)}finally{_(!1)}},S=l.useCallback(ae.debounce((t,s)=>{k(t,s)},500),[]);l.useEffect(()=>(S(u,x),()=>S.cancel()),[u,x,S]);const G=t=>{B(t.target.value),h(1)},O=async t=>{try{await te.requestBook(t),N({...i,[t]:"requested"})}catch(s){console.error("Error requesting book",s),N({...i,[t]:"error"})}},Q=async t=>{try{await se.create(t),N({...i,[t]:"reserved"}),alert("Book reserved successfully!")}catch(s){console.error("Error reserving book",s),alert("Failed to reserve book.")}},U=async(t,s)=>{if(t.preventDefault(),!!window.confirm("Are you sure you want to delete this book?"))try{await d.delete(s),k(u,x)}catch(r){console.error("Error deleting book",r),alert("Failed to delete book.")}},W=async()=>{try{const[t,s]=await Promise.all([d.getAuthors(),d.getCategories()]);M(t.results||t),Y(s.results||s)}catch(t){console.error("Error fetching metadata",t)}},X=()=>{W(),m(!0)},H=async t=>{t.preventDefault();try{let s=a.author_id,r=a.category_id;p&&w&&(s=(await d.createAuthor({name:w,bio:"Auto-created"})).id),b&&C&&(r=(await d.createCategory({name:C})).id);const g={...a,author_id:s,category_id:r};await d.create(g),alert("Book added successfully!"),m(!1),n({title:"",author_id:"",category_id:"",isbn:"",quantity:1,description:"",published_year:new Date().getFullYear()}),j(!1),D(""),y(!1),R(""),k(u,x)}catch(s){console.error("Error adding book",s),alert("Failed to add book.")}};return q&&!v.length?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-6 pb-10",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center gap-4 bg-white p-6 rounded-xl border border-slate-200 shadow-sm sticky top-20 md:top-0 z-30",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-slate-900 tracking-tight flex items-center gap-2",children:[e.jsx(oe,{className:"text-blue-600 w-6 h-6"}),"Library Catalog"]}),e.jsx("p",{className:"text-sm text-slate-500 mt-1",children:"Browse and manage your library collection"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 w-full md:w-auto",children:[e.jsxs("div",{className:"relative group w-full md:w-96",children:[e.jsx(P,{className:"absolute left-3 top-2.5 h-5 w-5 text-slate-400 group-focus-within:text-blue-500 transition-colors"}),e.jsx("input",{type:"text",placeholder:"Search by title, author, or ISBN...",value:u,onChange:G,className:"input-field !pl-12 py-2.5"})]}),((F=o==null?void 0:o.profile)==null?void 0:F.is_admin)&&e.jsxs("button",{onClick:X,className:"flex items-center justify-center gap-2 px-5 py-2.5 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg shadow-sm transition-all active:scale-95",children:[e.jsx(I,{className:"w-5 h-5"}),"Add Book"]})]})]}),e.jsx("div",{className:"grid grid-cols-1 gap-2",children:v.map(t=>{var s,r,g,f;return e.jsxs("div",{className:"card p-3 flex flex-row gap-3 hover:border-blue-300 transition-colors duration-200 group items-center",children:[e.jsx("div",{className:"hidden sm:flex flex-shrink-0 w-10 h-10 bg-slate-50 rounded-lg items-center justify-center border border-slate-100",children:e.jsx(V,{className:"w-5 h-5 text-slate-300"})}),e.jsxs("div",{className:"flex-1 min-w-0 flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-base font-bold text-slate-900 group-hover:text-blue-700 transition-colors truncate",children:e.jsx($,{to:`/books/${t.id}`,children:t.title})}),e.jsx("div",{className:`flex-shrink-0 px-1.5 py-0.5 rounded text-[10px] font-bold border uppercase tracking-wide ${t.available_count>0?"bg-emerald-50 text-emerald-700 border-emerald-100":"bg-red-50 text-red-700 border-red-100"}`,children:t.available_count>0?`${t.available_count} Avail`:"Out of Stock"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-x-2 text-[10px] text-slate-500 mt-0.5",children:[e.jsx("span",{className:"font-medium text-slate-700",children:((s=t.author)==null?void 0:s.name)||"Unknown"}),e.jsx("span",{className:"text-slate-300",children:"•"}),e.jsx("span",{children:((r=t.category)==null?void 0:r.name)||"General"}),e.jsx("span",{className:"text-slate-300",children:"•"}),e.jsx("span",{className:"font-mono bg-slate-50 px-1 rounded border border-slate-100",children:t.isbn})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[((g=o==null?void 0:o.profile)==null?void 0:g.is_student)&&e.jsx(e.Fragment,{children:t.available_count>0?e.jsx("button",{onClick:()=>O(t.id),disabled:i[t.id]==="requested",className:`px-3 py-1.5 rounded-lg text-xs font-semibold transition-all shadow-sm flex items-center gap-1.5 whitespace-nowrap border
                                                    ${i[t.id]==="requested"?"bg-emerald-50 text-emerald-700 border-emerald-200 cursor-default":"bg-blue-600 hover:bg-blue-700 text-white border-transparent shadow-blue-500/20"}`,children:i[t.id]==="requested"?e.jsx(ie,{className:"w-3.5 h-3.5"}):"Request"}):e.jsxs("button",{onClick:()=>Q(t.id),disabled:i[t.id]==="reserved",className:`px-3 py-1.5 rounded-lg text-xs font-semibold transition-all shadow-sm flex items-center gap-1.5 whitespace-nowrap border
                                                    ${i[t.id]==="reserved"?"bg-purple-50 text-purple-700 border-purple-200 cursor-default":"bg-white text-purple-700 border-purple-200 hover:bg-purple-50"}`,children:[e.jsx(Z,{className:"w-3.5 h-3.5"}),i[t.id]==="reserved"?"Reserved":"Reserve"]})}),((f=o==null?void 0:o.profile)==null?void 0:f.is_admin)&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{to:`/admin/books/edit/${t.id}`,className:"px-3 py-1.5 text-xs font-medium text-slate-700 bg-white border border-slate-200 hover:bg-slate-50 hover:text-blue-600 rounded-lg transition-colors",children:"Edit"}),e.jsx("button",{onClick:J=>U(J,t.id),className:"p-1.5 text-slate-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Delete Book",children:e.jsx(ne,{className:"w-4 h-4"})})]})]})]})]},t.id)})}),v.length===0&&!q&&e.jsxs("div",{className:"text-center py-20 bg-slate-50 rounded-xl border border-dashed border-slate-200",children:[e.jsx("div",{className:"w-16 h-16 bg-white rounded-full flex items-center justify-center mx-auto mb-4 shadow-sm border border-slate-100",children:e.jsx(P,{className:"w-8 h-8 text-slate-300"})}),e.jsx("h3",{className:"text-slate-900 font-bold text-lg mb-1",children:"No books found"}),e.jsx("p",{className:"text-slate-500",children:"We couldn't find any books matching your search."}),e.jsx("button",{onClick:()=>{B(""),h(1)},className:"mt-4 px-4 py-2 bg-white border border-slate-300 text-slate-700 font-medium rounded-lg hover:bg-slate-50 transition-colors shadow-sm",children:"Clear Search"})]}),(c.next||c.previous)&&e.jsxs("div",{className:"flex justify-center items-center gap-3 pt-6 border-t border-slate-200 mt-6",children:[e.jsx("button",{onClick:()=>h(t=>Math.max(1,t-1)),disabled:!c.previous,className:`p-2 rounded-lg border transition-all ${c.previous?"bg-white text-slate-600 border-slate-200 hover:bg-slate-50 hover:border-slate-300 shadow-sm":"bg-slate-50 text-slate-300 border-slate-100 cursor-not-allowed"}`,children:e.jsx(re,{className:"w-5 h-5"})}),e.jsxs("span",{className:"text-sm font-medium text-slate-600 px-4",children:["Page ",e.jsx("span",{className:"text-slate-900 font-bold",children:x})]}),e.jsx("button",{onClick:()=>h(t=>t+1),disabled:!c.next,className:`p-2 rounded-lg border transition-all ${c.next?"bg-white text-slate-600 border-slate-200 hover:bg-slate-50 hover:border-slate-300 shadow-sm":"bg-slate-50 text-slate-300 border-slate-100 cursor-not-allowed"}`,children:e.jsx(le,{className:"w-5 h-5"})})]}),z&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/50 backdrop-blur-sm animate-fade-in",children:e.jsxs("div",{className:"bg-white w-full max-w-2xl rounded-xl shadow-2xl relative max-h-[90vh] overflow-y-auto animate-slide-up border border-slate-200",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-100 bg-slate-50/50 rounded-t-xl sticky top-0 bg-opacity-95 backdrop-blur z-10",children:[e.jsxs("h2",{className:"text-xl font-bold text-slate-900 flex items-center gap-3",children:[e.jsx(I,{className:"w-5 h-5 text-blue-600"}),"Add New Book"]}),e.jsx("button",{onClick:()=>m(!1),className:"p-2 rounded-lg hover:bg-slate-200 text-slate-400 hover:text-slate-600 transition-colors",children:e.jsx(ee,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"p-8",children:e.jsxs("form",{onSubmit:H,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-700",children:"Title"}),e.jsx("input",{type:"text",value:a.title,onChange:t=>n({...a,title:t.target.value}),className:"input-field",required:!0,placeholder:"e.g. The Great Gatsby"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-700",children:"ISBN"}),e.jsx("input",{type:"text",value:a.isbn,onChange:t=>n({...a,isbn:t.target.value}),className:"input-field",required:!0,placeholder:"e.g. 978-3-16-148410-0"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-700",children:"Author"}),e.jsxs("select",{value:p?"others":a.author_id,onChange:t=>{t.target.value==="others"?j(!0):j(!1)||n({...a,author_id:t.target.value})},className:"input-field appearance-none bg-no-repeat bg-right",required:!p,children:[e.jsx("option",{value:"",children:"Select Author"}),L.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id)),e.jsx("option",{value:"others",className:"font-semibold text-blue-600",children:"+ Add New Author"})]}),p&&e.jsx("input",{type:"text",placeholder:"Enter New Author Name",value:w,onChange:t=>D(t.target.value),className:"input-field mt-2 border-blue-300 ring-2 ring-blue-50",required:!0})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-700",children:"Category"}),e.jsxs("select",{value:b?"others":a.category_id,onChange:t=>{t.target.value==="others"?y(!0):y(!1)||n({...a,category_id:t.target.value})},className:"input-field appearance-none bg-no-repeat bg-right",required:!b,children:[e.jsx("option",{value:"",children:"Select Category"}),T.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id)),e.jsx("option",{value:"others",className:"font-semibold text-blue-600",children:"+ Add New Category"})]}),b&&e.jsx("input",{type:"text",placeholder:"Enter New Category Name",value:C,onChange:t=>R(t.target.value),className:"input-field mt-2 border-blue-300 ring-2 ring-blue-50",required:!0})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-700",children:"Quantity"}),e.jsx("input",{type:"number",min:"1",value:a.quantity,onChange:t=>n({...a,quantity:t.target.value}),className:"input-field",required:!0})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-700",children:"Year"}),e.jsx("input",{type:"number",min:"1900",max:new Date().getFullYear()+1,value:a.published_year,onChange:t=>n({...a,published_year:t.target.value}),className:"input-field",required:!0})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-700",children:"Description"}),e.jsx("textarea",{value:a.description,onChange:t=>n({...a,description:t.target.value}),className:"input-field h-32 resize-none",required:!0,placeholder:"Brief summary of the book..."})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-slate-100",children:[e.jsx("button",{type:"button",onClick:()=>m(!1),className:"px-6 py-2.5 text-slate-600 font-medium hover:bg-slate-100 rounded-lg transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-6 py-2.5 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 shadow-sm shadow-blue-500/30",children:"Save Book"})]})]})})]})})]})};export{ve as default};
