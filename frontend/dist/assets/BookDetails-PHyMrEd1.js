import{c as A,i as F,a as I,u as $,r as n,j as e,B as k,k as L,C as M,M as R}from"./index-B0U1T1C1.js";import{B as U}from"./book.service-CAcsJwBd.js";import{I as P}from"./issue.service-CORyrTen.js";import{R as T}from"./reservation.service-BfQRBp_R.js";import{R as x}from"./review.service-CCNSrpAY.js";import{A as W}from"./arrow-left-D5XVrWFF.js";import{C as Y}from"./check-Ce-VbAi1.js";import{S as B}from"./star-CfixiURX.js";const z=A("Tag",[["path",{d:"M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z",key:"14b2ls"}],["path",{d:"M7 7h.01",key:"7u93v4"}]]),ee=()=>{var p,f,j,v;const{id:r}=F(),u=I(),{user:l}=$(),[t,S]=n.useState(null),[q,C]=n.useState(!0),[o,d]=n.useState(null),[h,b]=n.useState([]),[i,m]=n.useState({rating:5,comment:""});n.useEffect(()=>{(async()=>{try{const a=await U.get(r);S(a),d("none");const c=await x.getForBook(r);b(c.results||c)}catch(a){console.error("Error fetching book details",a)}finally{C(!1)}})()},[r,u]);const _=async()=>{try{await P.requestBook(r),d("requested"),alert("Book requested successfully!")}catch(s){console.error("Error requesting book",s),alert("Failed to request book.")}},D=async()=>{try{await T.create(r),d("reserved"),alert("Book reserved successfully!")}catch(s){console.error("Error reserving book",s),alert("Failed to reserve book.")}},E=async s=>{s.preventDefault();try{await x.create({book_id:r,rating:i.rating,text:i.comment}),m({rating:5,comment:""}),alert("Review submitted! It will appear after moderation.");const a=await x.getForBook(r);b(a.results||a)}catch(a){console.error("Error submitting review",a),alert("Failed to submit review. You can only review each book once.")}};return q?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):t?e.jsxs("div",{className:"max-w-5xl mx-auto space-y-6 pb-10",children:[e.jsxs("button",{onClick:()=>u("/books"),className:"flex items-center text-slate-500 hover:text-slate-800 transition-colors font-medium",children:[e.jsx(W,{className:"w-5 h-5 mr-2"}),"Back to Catalog"]}),e.jsx("div",{className:"card overflow-hidden",children:e.jsxs("div",{className:"md:flex",children:[e.jsx("div",{className:"md:w-1/3 p-8 bg-slate-50 flex items-center justify-center border-r border-slate-100",children:e.jsxs("div",{className:"w-48 h-64 bg-white rounded-lg shadow-md border border-slate-200 flex flex-col items-center justify-center p-6 text-center",children:[e.jsx(k,{className:"w-16 h-16 text-slate-300 mb-4"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-2 w-24 bg-slate-100 rounded mx-auto"}),e.jsx("div",{className:"h-2 w-16 bg-slate-100 rounded mx-auto"}),e.jsx("div",{className:"h-2 w-20 bg-slate-100 rounded mx-auto"})]})]})}),e.jsxs("div",{className:"p-8 md:w-2/3",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-slate-900 leading-tight mb-2",children:t.title}),e.jsx("p",{className:"text-lg text-slate-600 font-medium",children:((p=t.author)==null?void 0:p.name)||"Unknown Author"})]}),e.jsx("div",{className:`px-4 py-1.5 rounded-full text-sm font-bold border ${t.available_count>0?"bg-emerald-50 text-emerald-700 border-emerald-100":"bg-red-50 text-red-700 border-red-100"}`,children:t.available_count>0?"Available":"Out of Stock"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-y-4 gap-x-8 text-sm text-slate-600 mb-8 border-y border-slate-100 py-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(z,{className:"w-4 h-4 mr-2.5 text-slate-400"}),e.jsx("span",{className:"font-semibold w-24",children:"Category:"}),e.jsx("span",{children:((f=t.category)==null?void 0:f.name)||"General"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"w-4 h-4 mr-2.5 flex items-center justify-center font-mono text-xs font-bold text-slate-400 border border-slate-300 rounded",children:"#"}),e.jsx("span",{className:"font-semibold w-24",children:"ISBN:"}),e.jsx("span",{className:"font-mono",children:t.isbn})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(L,{className:"w-4 h-4 mr-2.5 text-slate-400"}),e.jsx("span",{className:"font-semibold w-24",children:"Published:"}),e.jsx("span",{children:t.published_year})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(k,{className:"w-4 h-4 mr-2.5 text-slate-400"}),e.jsx("span",{className:"font-semibold w-24",children:"Quantity:"}),e.jsxs("span",{children:[t.quantity," copies"]})]})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"text-sm font-bold text-slate-900 uppercase tracking-wide mb-2",children:"Description"}),e.jsx("p",{className:"text-slate-600 leading-relaxed",children:t.description||"No description avaiable for this book."})]}),((j=l==null?void 0:l.profile)==null?void 0:j.is_student)&&e.jsx("div",{className:"flex gap-4",children:t.available_count>0?e.jsx("button",{onClick:_,disabled:o==="requested",className:`px-6 py-3 rounded-lg text-sm font-bold transition-all shadow-sm flex items-center justify-center gap-2 min-w-[200px]
                                            ${o==="requested"?"bg-emerald-50 text-emerald-700 border border-emerald-200 cursor-default":"bg-blue-600 hover:bg-blue-700 text-white shadow-blue-500/20 active:scale-95"}`,children:o==="requested"?e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"w-5 h-5"})," Requested"]}):e.jsx(e.Fragment,{children:"Request to Borrow"})}):e.jsxs("button",{onClick:D,disabled:o==="reserved",className:`px-6 py-3 rounded-lg text-sm font-bold transition-all shadow-sm flex items-center justify-center gap-2 min-w-[200px]
                                            ${o==="reserved"?"bg-purple-50 text-purple-700 border border-purple-200 cursor-default":"bg-white text-purple-700 border border-purple-200 hover:bg-purple-50"}`,children:[e.jsx(M,{className:"w-5 h-5"}),o==="reserved"?"Reserved":"Reserve Book"]})}),((v=l==null?void 0:l.profile)==null?void 0:v.is_admin)&&e.jsx("div",{className:"flex gap-4",children:e.jsx("button",{className:"px-6 py-3 bg-white border border-slate-200 text-slate-700 font-bold rounded-lg hover:bg-slate-50 transition-colors",children:"Edit Book Details"})})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"card p-8",children:[e.jsx("div",{className:"flex items-center justify-between mb-8",children:e.jsxs("h2",{className:"text-xl font-bold text-slate-900 flex items-center gap-2",children:[e.jsx(R,{className:"w-5 h-5 text-slate-400"}),"Student Reviews"]})}),h.length>0?e.jsx("div",{className:"space-y-6",children:h.map((s,a)=>{var c,g,N,w;return e.jsxs("div",{className:"border-b border-slate-100 pb-6 last:border-0 last:pb-0",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center border border-white shadow-sm overflow-hidden bg-cover bg-center",style:(g=(c=s.user)==null?void 0:c.profile)!=null&&g.avatar?{backgroundImage:`url(http://127.0.0.1:8000${s.user.profile.avatar})`}:{},children:!((w=(N=s.user)==null?void 0:N.profile)!=null&&w.avatar)&&e.jsx("span",{className:"text-xs font-bold text-slate-400",children:(s.user_username||"U").charAt(0).toUpperCase()})}),e.jsx("span",{className:"font-semibold text-slate-900",children:s.user_username})]}),e.jsx("div",{className:"flex text-yellow-400",children:[...Array(5)].map((G,y)=>e.jsx(B,{className:`w-4 h-4 ${y<s.rating?"fill-current":"text-slate-200"}`},y))})]}),e.jsx("p",{className:"text-slate-600 text-sm leading-relaxed pl-10",children:s.text})]},a)})}):e.jsxs("div",{className:"text-center py-12 bg-slate-50 rounded-lg border border-dashed border-slate-200",children:[e.jsx(R,{className:"w-10 h-10 text-slate-300 mx-auto mb-3"}),e.jsx("p",{className:"text-slate-500 font-medium",children:"No reviews yet."}),e.jsx("p",{className:"text-sm text-slate-400",children:"Be the first to share your thoughts!"})]})]})}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"card p-6 sticky top-24",children:[e.jsx("h3",{className:"font-bold text-slate-900 mb-4",children:"Write a Review"}),e.jsxs("form",{onSubmit:E,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wide mb-1.5",children:"Rating"}),e.jsx("div",{className:"flex gap-2",children:[1,2,3,4,5].map(s=>e.jsx("button",{type:"button",onClick:()=>m({...i,rating:s}),className:"focus:outline-none transition-transform hover:scale-110",children:e.jsx(B,{className:`w-6 h-6 ${s<=i.rating?"text-yellow-400 fill-current":"text-slate-200"}`})},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wide mb-1.5",children:"Your Review"}),e.jsx("textarea",{className:"input-field h-32 resize-none text-sm border-slate-200 focus:border-blue-500 focus:ring-4 focus:ring-blue-500/10 transition-all outline-none rounded-xl p-4",placeholder:"What did you think about this book?",value:i.comment,onChange:s=>m({...i,comment:s.target.value}),required:!0})]}),e.jsx("button",{type:"submit",className:"w-full py-2.5 bg-blue-600 text-white font-bold rounded-lg hover:bg-blue-700 transition-colors shadow-lg shadow-blue-500/20 active:scale-95",children:"Submit Review"})]})]})})]})]}):e.jsx("div",{className:"text-center p-10 text-slate-500",children:"Book not found"})};export{ee as default};
