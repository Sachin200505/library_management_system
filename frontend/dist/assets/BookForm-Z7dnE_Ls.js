import{i as k,a as S,r as i,j as e}from"./index-B0U1T1C1.js";import{B as c}from"./book.service-CAcsJwBd.js";import{A as C}from"./arrow-left-D5XVrWFF.js";import{A as q}from"./alert-circle-DhW1dSqa.js";import{S as D}from"./save-CG2Cxpcj.js";const P=()=>{const{id:d}=k(),g=S(),u=!!d,[a,x]=i.useState({title:"",isbn:"",author:"",category:"",quantity:1,description:"",published_year:new Date().getFullYear()}),[f,j]=i.useState([]),[N,v]=i.useState([]),[b,h]=i.useState(!1),[y,m]=i.useState("");i.useEffect(()=>{(async()=>{var s,n;try{const[l,p]=await Promise.all([c.getAuthors(),c.getCategories()]);if(j(l.results||l),v(p.results||p),u){const o=await c.get(d);x({title:o.title||"",isbn:o.isbn||"",author:((s=o.author)==null?void 0:s.id)||"",category:((n=o.category)==null?void 0:n.id)||"",quantity:o.quantity||1,description:o.description||"",published_year:o.published_year||new Date().getFullYear()})}}catch(l){console.error("Error fetching data",l),m("Failed to load initial data")}})()},[d,u]);const r=t=>{const{name:s,value:n}=t.target;x(l=>({...l,[s]:s==="quantity"||s==="published_year"?parseInt(n):n}))},w=async t=>{t.preventDefault(),h(!0),m("");try{u?await c.update(d,a):await c.create(a),g("/admin/books")}catch(s){console.error("Error saving book",s),m("Failed to save book. Please check your data.")}finally{h(!1)}};return e.jsxs("div",{className:"max-w-2xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>g("/admin/books"),className:"flex items-center text-gray-400 hover:text-white transition-colors",children:[e.jsx(C,{className:"w-5 h-5 mr-2"}),"Back to Books"]}),e.jsx("h1",{className:"text-2xl font-bold text-white",children:u?"Edit Book":"Add New Book"})]}),y&&e.jsxs("div",{className:"bg-red-500/10 border border-red-500/50 text-red-200 p-4 rounded-lg flex items-center",children:[e.jsx(q,{className:"w-5 h-5 mr-2"}),y]}),e.jsxs("form",{onSubmit:w,className:"bg-gray-800 border border-gray-700 rounded-xl p-6 space-y-6 shadow-xl",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300",children:"Title"}),e.jsx("input",{type:"text",name:"title",value:a.title,onChange:r,className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-blue-500 outline-none",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300",children:"ISBN"}),e.jsx("input",{type:"text",name:"isbn",value:a.isbn,onChange:r,className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-blue-500 outline-none",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300",children:"Author"}),e.jsxs("select",{name:"author",value:a.author,onChange:r,className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-blue-500 outline-none",required:!0,children:[e.jsx("option",{value:"",children:"Select Author"}),f.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300",children:"Category"}),e.jsxs("select",{name:"category",value:a.category,onChange:r,className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-blue-500 outline-none",required:!0,children:[e.jsx("option",{value:"",children:"Select Category"}),N.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300",children:"Quantity"}),e.jsx("input",{type:"number",name:"quantity",min:"1",value:a.quantity,onChange:r,className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-blue-500 outline-none",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300",children:"Published Year"}),e.jsx("input",{type:"number",name:"published_year",max:new Date().getFullYear(),value:a.published_year,onChange:r,className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-blue-500 outline-none"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300",children:"Description"}),e.jsx("textarea",{name:"description",rows:"4",value:a.description,onChange:r,className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-blue-500 outline-none"})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsxs("button",{type:"submit",disabled:b,className:"flex items-center px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(D,{className:"w-5 h-5 mr-2"}),b?"Saving...":"Save Book"]})})]})]})};export{P as default};
