import{c as P,r as l,j as e,X as S,k as v,C as D}from"./index-B0U1T1C1.js";import{C as w,F as N}from"./fine.service-Dk8oEEOI.js";import{S as E}from"./shield-check-Bj171qGn.js";import{L as y}from"./lock-CtMYUMSI.js";import{A as F}from"./alert-octagon-OAG5jzE2.js";const k=P("CheckCircle2",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),L=({isOpen:m,onClose:f,fineAmount:p,onPaymentComplete:j})=>{const[r,h]=l.useState("input"),[c,d]=l.useState({number:"",expiry:"",cvv:"",name:""}),[i,o]=l.useState("");if(l.useEffect(()=>{m&&(h("input"),d({number:"",expiry:"",cvv:"",name:""}),o(""))},[m]),!m)return null;const u=t=>{const s=t.replace(/\s+/g,"").replace(/[^0-9]/gi,""),a=[];for(let n=0;n<s.length;n+=4)a.push(s.substring(n,n+4));return a.length>1?a.join(" "):t},g=t=>{const s=t.replace(/\s+/g,"").replace(/[^0-9]/gi,"");return s.length>=2?s.substring(0,2)+"/"+s.substring(2,4):s},x=t=>{const{name:s,value:a}=t.target;let n=a;s==="number"&&(n=u(a)),s==="expiry"&&(n=g(a)),s==="cvv"&&(n=a.replace(/[^0-9]/g,"").slice(0,3)),d(C=>({...C,[s]:n}))},b=async t=>{if(t.preventDefault(),o(""),c.number.length<16){o("Invalid card number");return}if(c.cvv.length<3){o("Invalid CVV");return}h("processing"),setTimeout(()=>{h("success"),setTimeout(()=>{j()},2e3)},2500)};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/40 backdrop-blur-sm animate-fade-in",children:e.jsxs("div",{className:"bg-white border border-slate-200 rounded-2xl w-full max-w-md shadow-2xl relative overflow-hidden animate-scale-up",children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b border-slate-100 bg-slate-50/50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{className:"w-5 h-5 text-emerald-600"}),e.jsx("h3",{className:"text-lg font-bold text-slate-800 tracking-tight",children:"Secure Payment"})]}),e.jsx("button",{onClick:f,disabled:r==="processing"||r==="success",className:"text-slate-400 hover:text-slate-600 transition-colors disabled:opacity-50",children:e.jsx(S,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-8",children:[r==="input"&&e.jsxs("form",{onSubmit:b,className:"space-y-5",children:[e.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-100 rounded-xl flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-slate-600",children:"Total Amount"}),e.jsxs("span",{className:"text-2xl font-bold text-slate-900 font-mono",children:["₹",p]})]}),i&&e.jsx("div",{className:"text-sm text-red-600 bg-red-50 border border-red-100 p-3 rounded-lg text-center font-medium",children:i}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wide mb-1.5",children:"Card Number"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",name:"number",placeholder:"0000 0000 0000 0000",value:c.number,onChange:x,maxLength:"19",className:"w-full pl-10 pr-4 py-3 bg-white border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all font-mono text-slate-700",required:!0}),e.jsx(w,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wide mb-1.5",children:"Expiry"}),e.jsx("input",{type:"text",name:"expiry",placeholder:"MM/YY",value:c.expiry,onChange:x,maxLength:"5",className:"w-full px-4 py-3 bg-white border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all font-mono text-slate-700 text-center",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wide mb-1.5",children:"CVV"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"password",name:"cvv",placeholder:"123",value:c.cvv,onChange:x,maxLength:"3",className:"w-full px-4 py-3 bg-white border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all font-mono text-slate-700 text-center",required:!0}),e.jsx(y,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-300"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wide mb-1.5",children:"Cardholder Name"}),e.jsx("input",{type:"text",name:"name",placeholder:"JOHN DOE",value:c.name,onChange:x,className:"w-full px-4 py-3 bg-white border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all text-slate-700 uppercase",required:!0})]})]}),e.jsxs("button",{type:"submit",className:"w-full py-3.5 bg-slate-900 hover:bg-slate-800 text-white font-bold rounded-xl shadow-lg shadow-slate-900/20 transition-all transform active:scale-95 flex items-center justify-center gap-2",children:[e.jsx(y,{className:"w-4 h-4"})," Pay Securely"]}),e.jsx("p",{className:"text-center text-xs text-slate-400 mt-2",children:"This is a secure 256-bit encrypted transaction being simulated."})]}),r==="processing"&&e.jsxs("div",{className:"text-center py-10 space-y-4 animate-fade-in",children:[e.jsxs("div",{className:"relative inline-flex",children:[e.jsx("div",{className:"w-16 h-16 rounded-full border-4 border-slate-100 border-t-blue-600 animate-spin"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(y,{className:"w-6 h-6 text-slate-300"})})]}),e.jsx("h3",{className:"text-lg font-bold text-slate-800",children:"Processing Payment..."}),e.jsx("p",{className:"text-slate-500 text-sm",children:"Please do not close this window."})]}),r==="success"&&e.jsxs("div",{className:"text-center py-8 space-y-4 animate-scale-up",children:[e.jsx("div",{className:"w-20 h-20 bg-emerald-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(k,{className:"w-10 h-10 text-emerald-600"})}),e.jsx("h3",{className:"text-2xl font-bold text-emerald-600",children:"Payment Successful!"}),e.jsx("p",{className:"text-slate-500",children:"Your fine has been cleared. Redirecting..."})]})]})]})})},V=()=>{const[m,f]=l.useState([]),[p,j]=l.useState([]),[r,h]=l.useState(!0),[c,d]=l.useState(!1),[i,o]=l.useState(null);l.useEffect(()=>{u()},[]);const u=async()=>{try{const[t,s]=await Promise.all([N.getUserFines(),N.getPaymentHistory()]);f(t.results||t),j(s.results||s)}catch(t){console.error("Error fetching fine data",t)}finally{h(!1)}},g=t=>{o(t),d(!0)},x=async()=>{if(i)try{await N.payFine(i.id),d(!1),u()}catch(t){console.error("Payment failed",t),alert("Payment failed. Please try again.")}},b=m.filter(t=>t.status==="UNPAID");return r?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-8 animate-fade-in pb-10",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-slate-900 tracking-tight",children:"My Fines & Payments"}),e.jsx("p",{className:"text-slate-500 mt-1",children:"Manage your outstanding fines and view payment history."})]}),e.jsxs("div",{className:"card overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-slate-100 flex items-center gap-3 bg-red-50/50",children:[e.jsx("div",{className:"p-2 bg-red-100 rounded-lg",children:e.jsx(F,{className:"text-red-600 w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-slate-900",children:"Outstanding Fines"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Fines that need to be paid"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-slate-50 border-b border-slate-200",children:[e.jsx("th",{className:"px-6 py-4 text-xs font-bold text-slate-500 uppercase tracking-wider",children:"Book"}),e.jsx("th",{className:"px-6 py-4 text-xs font-bold text-slate-500 uppercase tracking-wider",children:"Amount"}),e.jsx("th",{className:"px-6 py-4 text-xs font-bold text-slate-500 uppercase tracking-wider",children:"Issue Date"}),e.jsx("th",{className:"px-6 py-4 text-xs font-bold text-slate-500 uppercase tracking-wider text-right",children:"Action"})]})}),e.jsxs("tbody",{className:"divide-y divide-slate-100 bg-white",children:[b.map(t=>{var s,a;return e.jsxs("tr",{className:"hover:bg-red-50/10 transition-colors group",children:[e.jsx("td",{className:"px-6 py-4 font-semibold text-slate-900",children:((a=(s=t.issue)==null?void 0:s.book)==null?void 0:a.title)||"Unknown"}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-1 font-mono font-bold text-red-600 text-lg",children:[e.jsx("span",{children:"₹"}),t.amount]})}),e.jsx("td",{className:"px-6 py-4 text-sm text-slate-600",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{className:"w-4 h-4 text-slate-400"}),new Date(t.created_at).toLocaleDateString()]})}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsxs("button",{onClick:()=>g(t),className:"inline-flex items-center gap-2 px-5 py-2.5 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg text-sm font-bold shadow-sm hover:shadow-md transition-all active:scale-95",children:[e.jsx(w,{className:"w-4 h-4"}),"Pay Now"]})})]},t.id)}),b.length===0&&!r&&e.jsx("tr",{children:e.jsx("td",{colSpan:"4",className:"px-6 py-12 text-center text-slate-500",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-16 h-16 bg-emerald-50 rounded-full flex items-center justify-center mb-4",children:e.jsx(k,{className:"w-8 h-8 text-emerald-500"})}),e.jsx("p",{className:"font-bold text-slate-800",children:"No outstanding fines!"}),e.jsx("p",{className:"text-sm text-slate-500",children:"You are all clear."})]})})})]})]})})]}),e.jsxs("div",{className:"card overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-slate-100 flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-slate-100 rounded-lg",children:e.jsx(D,{className:"text-slate-600 w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-slate-900",children:"Payment History"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Past transactions and receipts"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-slate-50 border-b border-slate-200",children:[e.jsx("th",{className:"px-6 py-4 text-xs font-bold text-slate-500 uppercase tracking-wider",children:"Amount"}),e.jsx("th",{className:"px-6 py-4 text-xs font-bold text-slate-500 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-6 py-4 text-xs font-bold text-slate-500 uppercase tracking-wider",children:"Reference"}),e.jsx("th",{className:"px-6 py-4 text-xs font-bold text-slate-500 uppercase tracking-wider",children:"Status"})]})}),e.jsxs("tbody",{className:"divide-y divide-slate-100 bg-white",children:[p.map(t=>e.jsxs("tr",{className:"hover:bg-slate-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-1 font-mono font-bold text-emerald-600",children:[e.jsx("span",{children:"₹"}),t.amount]})}),e.jsx("td",{className:"px-6 py-4 text-sm text-slate-600",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{className:"w-4 h-4 text-slate-400"}),new Date(t.created_at).toLocaleDateString()]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"font-mono text-xs text-slate-500 bg-slate-100 rounded px-2 py-1 border border-slate-200",children:t.reference})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-bold border ${t.status==="COMPLETED"||t.status==="PAID"?"bg-emerald-50 text-emerald-700 border-emerald-100":t.status==="FAILED"?"bg-red-50 text-red-700 border-red-100":"bg-amber-50 text-amber-700 border-amber-100"}`,children:t.status})})]},t.id)),p.length===0&&!r&&e.jsx("tr",{children:e.jsx("td",{colSpan:"4",className:"px-6 py-12 text-center text-slate-500",children:e.jsx("p",{children:"No payment history found."})})})]})]})})]}),e.jsx(L,{isOpen:c,onClose:()=>d(!1),fineAmount:(i==null?void 0:i.amount)||0,onPaymentComplete:x})]})};export{V as default};
