import{u as q,r as p,j as e,U as S,S as D,m as A}from"./index-B0U1T1C1.js";import{U}from"./user.service-eXvVqay8.js";import{C as F}from"./check-circle-BtgdL02B.js";import{A as I}from"./alert-circle-DhW1dSqa.js";import{M as k,G as $}from"./mail-C_KK6BOJ.js";import{L as g}from"./lock-CtMYUMSI.js";import{K as B}from"./key-smfloJ8n.js";const J=()=>{var j,v,y,_,C,P;const{user:s}=q(),[r,w]=p.useState({current_password:"",new_password:"",confirm_password:""}),[x,h]=p.useState(!1),[u,n]=p.useState({type:"",text:""}),L=t=>{switch(t){case"OWNER":return e.jsx(A,{className:"w-5 h-5 text-yellow-500"});case"ADMIN":return e.jsx(D,{className:"w-5 h-5 text-purple-500"});default:return e.jsx($,{className:"w-5 h-5 text-blue-500"})}},f=t=>{w({...r,[t.target.name]:t.target.value})},E=async t=>{var i,m;if(t.preventDefault(),n({type:"",text:""}),r.new_password!==r.confirm_password){n({type:"error",text:"New passwords do not match."});return}if(r.new_password.length<6){n({type:"error",text:"Password must be at least 6 characters."});return}h(!0);try{await U.changePassword({current_password:r.current_password,new_password:r.new_password}),n({type:"success",text:"Password changed successfully!"}),w({current_password:"",new_password:"",confirm_password:""})}catch(l){const o=((m=(i=l.response)==null?void 0:i.data)==null?void 0:m.detail)||"Failed to change password.";n({type:"error",text:o})}finally{h(!1)}},[a,N]=p.useState({username:(s==null?void 0:s.username)||"",email:(s==null?void 0:s.email)||"",first_name:(s==null?void 0:s.first_name)||"",last_name:(s==null?void 0:s.last_name)||"",roll_number:((j=s==null?void 0:s.profile)==null?void 0:j.roll_number)||"",avatar:null}),[b,R]=p.useState((v=s==null?void 0:s.profile)!=null&&v.avatar?s.profile.avatar.startsWith("http")?s.profile.avatar:`http://127.0.0.1:8000${s.profile.avatar}`:null),c=t=>{if(t.target.name==="avatar"){const i=t.target.files[0];i&&(N({...a,avatar:i}),R(URL.createObjectURL(i)))}else N({...a,[t.target.name]:t.target.value})},M=async t=>{var i,m;if(t.preventDefault(),n({type:"",text:""}),!((i=s==null?void 0:s.profile)!=null&&i.id)){n({type:"error",text:"User profile ID missing. Please logout and login again."});return}h(!0);try{const l=new FormData;l.append("username",a.username),l.append("email",a.email),l.append("first_name",a.first_name),l.append("last_name",a.last_name),l.append("roll_number",a.roll_number),a.avatar&&l.append("avatar",a.avatar),await U.updateProfile(s.profile.id,l),n({type:"success",text:"Profile updated successfully! Refreshing..."}),setTimeout(()=>window.location.reload(),1500)}catch(l){console.error("Profile update error:",l);let o="Failed to update profile.";if((m=l.response)!=null&&m.data){const d=l.response.data;d.username?o=`Username: ${d.username[0]}`:d.email?o=`Email: ${d.email[0]}`:d.detail&&(o=d.detail)}n({type:"error",text:o})}finally{h(!1)}};return e.jsxs("div",{className:"space-y-6 max-w-4xl mx-auto pb-10 animate-fade-in",children:[e.jsxs("h1",{className:"text-2xl font-bold text-slate-900 tracking-tight flex items-center gap-2",children:[e.jsx(S,{className:"text-blue-600 w-6 h-6"}),"My Profile"]}),u.text&&e.jsxs("div",{className:`p-4 rounded-lg flex items-center gap-3 shadow-sm ${u.type==="success"?"bg-emerald-50 text-emerald-700 border border-emerald-100":"bg-red-50 text-red-700 border border-red-100"}`,children:[u.type==="success"?e.jsx(F,{className:"w-5 h-5 flex-shrink-0"}):e.jsx(I,{className:"w-5 h-5 flex-shrink-0"}),e.jsx("span",{className:"font-medium",children:u.text})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx("div",{className:"md:col-span-1 space-y-6",children:e.jsxs("div",{className:"card p-6 text-center",children:[e.jsxs("div",{className:"relative w-32 h-32 mx-auto mb-6 group",children:[e.jsx("div",{className:"w-full h-full bg-slate-100 rounded-full flex items-center justify-center border-4 border-white shadow-md overflow-hidden bg-cover bg-center",style:b?{backgroundImage:`url(${b})`}:{},children:!b&&e.jsx("span",{className:"text-4xl font-bold text-slate-300",children:(y=s==null?void 0:s.username)==null?void 0:y.charAt(0).toUpperCase()})}),e.jsxs("label",{className:"absolute bottom-0 right-0 p-2 bg-blue-600 text-white rounded-full shadow-lg cursor-pointer hover:bg-blue-700 transition-all hover:scale-110 active:scale-95 border-2 border-white",children:[e.jsx(D,{className:"w-4 h-4"}),e.jsx("input",{type:"file",name:"avatar",className:"hidden",accept:"image/*",onChange:c})]})]}),e.jsx("h2",{className:"text-2xl font-bold text-slate-900",children:s==null?void 0:s.username}),e.jsx("div",{className:"flex items-center justify-center gap-2 mt-2",children:e.jsxs("div",{className:"p-1 px-3 bg-slate-50 rounded-full flex items-center gap-2 border border-slate-100",children:[L((_=s==null?void 0:s.profile)==null?void 0:_.role),e.jsx("span",{className:"font-bold text-slate-600 text-sm uppercase tracking-wider",children:((C=s==null?void 0:s.profile)==null?void 0:C.role)||"STUDENT"})]})}),(s==null?void 0:s.email)&&e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-4 text-sm text-slate-500 bg-slate-50/50 p-2 rounded-lg",children:[e.jsx(k,{className:"w-4 h-4 text-blue-400"}),s.email]}),((P=s==null?void 0:s.profile)==null?void 0:P.roll_number)&&e.jsxs("div",{className:"mt-6 pt-6 border-t border-slate-100",children:[e.jsx("p",{className:"text-[10px] text-slate-400 uppercase tracking-[0.2em] font-black mb-1",children:"Library ID / Roll No"}),e.jsx("p",{className:"font-mono text-slate-800 font-bold bg-slate-50 p-2 rounded border border-slate-100",children:s.profile.roll_number})]})]})}),e.jsxs("div",{className:"md:col-span-2 space-y-6",children:[e.jsxs("div",{className:"card p-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-slate-900 mb-4 flex items-center gap-2",children:[e.jsx(S,{className:"w-5 h-5 text-slate-400"}),"Basic Details"]}),e.jsxs("form",{onSubmit:M,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-sm font-semibold text-slate-700",children:"First Name"}),e.jsx("input",{type:"text",name:"first_name",value:a.first_name,onChange:c,className:"input-field",placeholder:"First Name"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-sm font-semibold text-slate-700",children:"Last Name"}),e.jsx("input",{type:"text",name:"last_name",value:a.last_name,onChange:c,className:"input-field",placeholder:"Last Name"})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-sm font-semibold text-slate-700",children:"Username"}),e.jsx("input",{type:"text",name:"username",value:a.username,onChange:c,className:"input-field",required:!0})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-sm font-semibold text-slate-700",children:"Email"}),e.jsxs("div",{className:"relative",children:[e.jsx(k,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx("input",{type:"email",name:"email",value:a.email,onChange:c,className:"input-field !pl-10",required:!0})]})]}),e.jsx("div",{className:"pt-2 flex justify-end",children:e.jsx("button",{type:"submit",disabled:x,className:"px-6 py-2 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition-colors shadow-sm disabled:opacity-50",children:x?"Saving...":"Save Changes"})})]})]}),e.jsxs("div",{className:"card p-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-slate-900 mb-4 flex items-center gap-2",children:[e.jsx(g,{className:"w-5 h-5 text-slate-400"}),"Change Password"]}),e.jsxs("form",{onSubmit:E,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-sm font-semibold text-slate-700",children:"Current Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(B,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx("input",{type:"password",name:"current_password",value:r.current_password,onChange:f,className:"input-field !pl-10",required:!0,placeholder:"Enter current password"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-sm font-semibold text-slate-700",children:"New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(g,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx("input",{type:"password",name:"new_password",value:r.new_password,onChange:f,className:"input-field !pl-10",required:!0,placeholder:"Min 6 chars"})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-sm font-semibold text-slate-700",children:"Confirm New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(g,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx("input",{type:"password",name:"confirm_password",value:r.confirm_password,onChange:f,className:"input-field !pl-10",required:!0,placeholder:"Confirm new password"})]})]})]}),e.jsx("div",{className:"pt-2 flex justify-end",children:e.jsx("button",{type:"submit",disabled:x,className:"px-6 py-2 bg-slate-800 text-white font-semibold rounded-lg hover:bg-slate-900 transition-colors shadow-sm disabled:opacity-50",children:x?"Updating...":"Update Password"})})]})]})]})]})]})};export{J as default};
