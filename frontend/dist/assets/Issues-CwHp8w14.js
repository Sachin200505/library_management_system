import{r as n,u as B,a as P,j as e,H as w,M as A}from"./index-B0U1T1C1.js";import{I as y}from"./issue.service-CORyrTen.js";import{B as M}from"./book-open-CIpCioG8.js";import{A as U}from"./alert-octagon-OAG5jzE2.js";const q=()=>{var u,f,g;const[x,v]=n.useState([]),[k,_]=n.useState(!0),{user:t}=B(),E=P(),[o,m]=n.useState(1),l=8;n.useEffect(()=>{h()},[]);const h=async()=>{try{const s=await y.getAll();v(s.results||s)}catch(s){console.error("Error fetching issues",s)}finally{_(!1)}},I=async s=>{if(window.confirm("Are you sure you want to return this book?"))try{await y.returnBook(s),h()}catch(a){console.error("Error returning book",a),alert("Failed to return book")}},r=[...x].sort((s,a)=>{const d=new Date(s.issue_date||s.created_at);return new Date(a.issue_date||a.created_at)-d}),i=o*l,b=i-l,S=r.slice(b,i),p=Math.ceil(r.length/l),D=()=>m(s=>Math.min(s+1,p)),R=()=>m(s=>Math.max(s-1,1));return k?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-500"})}):e.jsxs("div",{className:"space-y-8 animate-fade-in pb-10",children:[e.jsx("div",{className:"flex justify-between items-center bg-white/50 p-6 rounded-2xl glass-card shadow-lg backdrop-blur-md border border-white/20 sticky top-0 z-10 w-full mb-6",children:e.jsxs("h1",{className:"text-3xl font-bold text-slate-800 flex items-center gap-3 font-heading",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(w,{className:"text-purple-600 w-8 h-8"})}),(u=t==null?void 0:t.profile)!=null&&u.is_admin||(f=t==null?void 0:t.profile)!=null&&f.is_owner?"Issued Books":"Issue History"]})}),e.jsxs("div",{className:"glass-card bg-white rounded-2xl overflow-hidden shadow-xl border border-slate-100",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{className:"bg-slate-50 border-b border-slate-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-xs font-bold text-slate-500 uppercase tracking-wider",children:"Book Details"}),((g=t==null?void 0:t.profile)==null?void 0:g.is_admin)&&e.jsx("th",{className:"px-6 py-4 text-xs font-bold text-slate-500 uppercase tracking-wider",children:"User"}),e.jsx("th",{className:"px-6 py-4 text-xs font-bold text-slate-500 uppercase tracking-wider",children:"Dates"}),e.jsx("th",{className:"px-6 py-4 text-xs font-bold text-slate-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-4 text-xs font-bold text-slate-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsxs("tbody",{className:"divide-y divide-slate-100",children:[S.map(s=>{var a,d,c,j,N;return e.jsxs("tr",{className:"hover:bg-slate-50/80 transition-colors border-b border-slate-100 hover:border-slate-200",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-50 rounded-lg text-blue-500",children:e.jsx(M,{className:"w-5 h-5"})}),e.jsx("span",{className:"font-semibold text-slate-700",children:((a=s.book)==null?void 0:a.title)||"Unknown Title"})]})}),((d=t==null?void 0:t.profile)==null?void 0:d.is_admin)&&e.jsx("td",{className:"px-6 py-4 text-slate-600 font-medium",children:(c=s.user)==null?void 0:c.username}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-600",children:[e.jsx("span",{className:"font-medium",children:"Issued:"})," ",s.issue_date||"-"]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-600",children:[e.jsx("span",{className:"font-medium text-orange-600",children:"Due:"})," ",s.due_date||"-"]}),s.return_date&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-600",children:[e.jsx("span",{className:"font-medium",children:"Returned:"})," ",s.return_date]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold border shadow-sm
                                                ${s.status==="ISSUED"?"bg-green-100 text-green-700 border-green-200":s.status==="RETURNED"?"bg-blue-100 text-blue-700 border-blue-200":s.status==="REQUESTED"?"bg-amber-100 text-amber-700 border-amber-200":"bg-red-100 text-red-700 border-red-200"}`,children:s.status}),s.is_overdue&&e.jsxs("span",{className:"px-3 py-1 bg-red-50 text-red-600 text-xs font-bold rounded-full border border-red-200 flex items-center gap-1 animate-pulse-slow",children:[e.jsx(U,{className:"w-3 h-3"})," Overdue"]})]})}),e.jsxs("td",{className:"px-6 py-4",children:[((j=t==null?void 0:t.profile)==null?void 0:j.is_admin)&&s.status==="ISSUED"&&e.jsx("button",{onClick:()=>I(s.id),className:"px-4 py-1.5 bg-white border border-slate-200 hover:border-blue-400 hover:text-blue-600 text-slate-600 text-sm font-semibold rounded-lg shadow-sm hover:shadow transition-all",children:"Mark Returned"}),((N=t==null?void 0:t.profile)==null?void 0:N.is_student)&&s.status==="RETURNED"&&e.jsxs("button",{onClick:()=>E(`/books/${s.book.id}`),className:"px-4 py-1.5 bg-blue-50 text-blue-600 hover:bg-blue-100 border border-blue-100 text-sm font-bold rounded-lg shadow-sm transition-all flex items-center gap-2",children:[e.jsx(A,{className:"w-4 h-4"})," Review Book"]})]})]},s.id)}),x.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"px-6 py-16 text-center text-slate-500",children:e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx("div",{className:"w-16 h-16 bg-slate-100 rounded-full flex items-center justify-center mb-4",children:e.jsx(w,{className:"w-8 h-8 text-slate-300"})}),e.jsx("p",{className:"text-lg font-medium",children:"No history found"}),e.jsx("p",{className:"text-sm text-slate-400",children:"You haven't issued or requested any books yet."})]})})})]})]})}),r.length>l&&e.jsxs("div",{className:"flex justify-between items-center px-6 py-4 bg-slate-50 border-t border-slate-200",children:[e.jsxs("span",{className:"text-sm text-slate-500",children:["Showing ",e.jsx("span",{className:"font-bold",children:b+1})," to ",e.jsx("span",{className:"font-bold",children:Math.min(i,r.length)})," of ",e.jsx("span",{className:"font-bold",children:r.length})," entries"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:R,disabled:o===1,className:"px-4 py-2 text-sm font-medium text-slate-600 bg-white border border-slate-200 rounded-lg hover:bg-slate-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Previous"}),e.jsx("button",{onClick:D,disabled:o===p,className:"px-4 py-2 text-sm font-medium text-slate-600 bg-white border border-slate-200 rounded-lg hover:bg-slate-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Next"})]})]})]})]})};export{q as default};
